<!DOCTYPE html>
<html lang="en">
<head>
    <title>PRASARNET</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/vendors/feather/feather.css">
    <link rel="stylesheet" href="~/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="~/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="~/css/vertical-layout-light/style.css">
    <link rel="shortcut icon" href="~/images/favicon.png" />
    <link rel="stylesheet" href="~/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="~/vendors/datatables.net-bs4/dataTables.bootstrap4.css">
    <link rel="stylesheet" type="text/css" href="~/js/select.dataTables.min.css">
</head>

<body>
    <div class="container-scroller">

        @* Nav bar content *@
        <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
            <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
                <a class="navbar-brand brand-logo mr-5" asp-controller="Home" asp-action="Index"><img src="~/images/mainlogo.png" class="mr-2" alt="logo" /></a>
                <a class="navbar-brand brand-logo-mini" asp-controller="Home" asp-action="Index"><img src="~/images/logoprasarnet.png" alt="logo" /></a>
            </div>
            <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
                <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
                    <span class="icon-menu"></span>
                </button>
                <ul class="navbar-nav navbar-nav-right">
                    <li class="nav-item mt-2">
                        <span class="h5 px-1"> Welcome : </span>
                        @{
                            var name = User?.Claims.FirstOrDefault(c => c.Type == "name")?.Value;
                        }
                        <span class="h5 text-success">@name</span>
                    </li>
                    <li class="nav-item nav-profile dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" id="profileDropdown">
                            <img src="~/images/profile.jpg" alt="profile" />
                        </a>
                        <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="profileDropdown">
                            <a class="dropdown-item">
                                <i class="ti-settings text-primary"></i>
                                Settings
                            </a>
                            <div>
                                @if (User.Identity?.IsAuthenticated ?? false)
                                {
                                    <a class="dropdown-item" asp-area="" asp-controller="Account" asp-action="Logout">
                                        <i class="ti-power-off text-primary"></i>
                                        Logout
                                    </a>
                                }
                            </div>
                        </div>
                    </li>
                </ul>
                <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
                    <span class="icon-menu"></span>
                </button>
            </div>
        </nav>

        @*Main Body*@
        <div class="container-fluid page-body-wrapper">

            @* Right side bar content *@
            <div class="theme-setting-wrapper" style="display:block;">
                <div id="settings-trigger"><i class="ti-settings"></i></div>
                <div id="theme-settings" class="settings-panel">
                    <i class="settings-close ti-close text-white"></i>
                    <p class="settings-heading bg-primary text-white mb-2">Assiged Roles</p>
                    <div>
                        @using System.Security.Claims
                        @{
                            var roles = User.Claims
                                .Where(c => c.Type == ClaimTypes.Role)
                                .Select(c => c.Value)
                                .ToList();

                            var permissions = User.Claims
                                .Where(c => c.Type == "permission")
                                .Select(c => c.Value)
                                .ToList();
                        }
                        @if (roles.Any())
                        {
                            <div class="overflow-auto card-body bg-dark-subtle" style="max-height: 20vh;">
                                @foreach (var role in roles)
                                {
                                    <p class="ml-3">@role</p>
                                }
                            </div>
                        }
                        else
                        {
                            <p>No roles assigned.</p>
                        }
                    </div>
                    <p class="settings-heading bg-primary text-white mt-2 mb-2">Granted Permissions</p>
                    @if (permissions.Any())
                    {
                        <div class="overflow-auto card-body bg-dark-subtle pb-5" style="max-height: 65vh;">
                            @foreach (var permission in permissions)
                            {
                                <p class="ml-3">@permission</p>
                            }
                        </div>

                    }
                    else
                    {
                        <p>No permissions assigned.</p>
                    }
                </div>
            </div>

            @* Left side bar content (Load Menu Items Role based) *@
            @await Component.InvokeAsync("Sidebar")

            @*Rendering Body*@
            <div class="main-panel">
                @RenderBody()
                <footer class="footer ">
                    <div class="d-sm-flex justify-content-center justify-content-sm-between">
                        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Copyright © 2025 <a href="https://prasarbharati.gov.in/" target="_blank">Prasarbharati</a>, Government of India. All Rights Reserved. </span>
                        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">  <i class="ti-heart text-danger ml-1"></i></span>
                    </div>
                </footer>
            </div>
        </div>

    </div>
    @* script *@
    <script src="~/vendors/js/vendor.bundle.base.js"></script>
    <script src="~/js/off-canvas.js"></script>
    <script src="~/js/hoverable-collapse.js"></script>
    <script src="~/js/template.js"></script>
    <script src="~/js/settings.js"></script>
    <script src="~/js/todolist.js"></script>
    <script src="~/vendors/chart.js/Chart.min.js"></script>
    <script src="~/vendors/datatables.net/jquery.dataTables.js"></script>
    <script src="~/vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
    <script src="~/vendors/moment/moment.min.js"></script>
    <script src="~/js/dataTables.select.min.js"></script>
    <script src="~/js/dashboard.js"></script>
    <script src="~/js/Chart.roundedBarCharts.js"></script>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/dist/jquery.validate.unobtrusive.min.js"></script>

    @await RenderSectionAsync("Scripts", required: false)
    <script>
        $(document).ready(function () {
            $('#statesTable').DataTable();
        });

        // Add this once in a layout-level script
        $(document).on('hidden.bs.modal', '.modal', function () {
            $('body').removeClass('modal-open');
            $('.modal-backdrop').remove();
        });
    </script>
</body>
</html>
